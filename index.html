<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unkenprojekt</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    #map {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
    .ol-popup {
      position: absolute;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
      pointer-events: none;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px; /* Increase the width to handle longer text */
      max-height: none; /* Remove max-height */
      overflow: visible; /* Remove scrolling */
      white-space: normal; /* Allow text wrapping */
      font-size: 20px; /* Increase font size */
    }
    .ol-popup:after, .ol-popup:before {
      top: 100%;
      left: 50%;
      border: solid transparent;
      content: " ";
      height: 0;
      width: 0;
      position: absolute;
      pointer-events: none;
    }
    .ol-popup:after {
      border-color: rgba(255, 255, 255, 0);
      border-top-color: white;
      border-width: 10px;
      margin-left: -10px;
    }
    .ol-popup:before {
      border-color: rgba(0, 0, 0, 0);
      border-top-color: rgba(0, 0, 0, 0.2);
      border-width: 11px;
      margin-left: -11px;
    }
    .bold {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="popup" class="ol-popup"></div>
  <script>
    const attribution = new ol.control.Attribution({
      collapsible: false,
    });
    const source = new ol.source.OSM();
    const map = new ol.Map({
      layers: [
        new ol.layer.Tile({
          source: source
        })
      ],
      controls: ol.control.defaults.defaults({attribution: false}).extend([attribution]),
      target: 'map',
      view: new ol.View({
        constrainResolution: true,
        center: ol.proj.fromLonLat([10.4515, 51.1657]),  // Center of Germany
        zoom: 6  // Zoom level to see all of Germany
      })
    });

    // Function to return different styles based on huepferlinge value
    function styleFunction(feature) {
      const huepferlinge = feature.get('huepferlinge');

      // Define different styles
      let fillColor = 'green';
      if (huepferlinge === 0) {
        fillColor = 'orange'; // Change color for huepferlinge = 0
      }

      return new ol.style.Style({
        image: new ol.style.Circle({
          radius: 10,  // Size of the dot
          fill: new ol.style.Fill({
            color: fillColor  // Conditional fill color
          }),
          stroke: new ol.style.Stroke({
            color: 'red',  // Red outline
            width: 3  // Thick outline
          })
        })
      });
    }

    const ToadLayer = new ol.layer.Vector({
      source: new ol.source.Vector({
        url: 'biotope.json',
        format: new ol.format.GeoJSON(),
      }),
      style: styleFunction // Apply the conditional style function
    });
    map.addLayer(ToadLayer);

    const select = new ol.interaction.Select({
      style: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 10,  // Same size as the original
          fill: new ol.style.Fill({
            color: 'yellow'  // Yellow fill
          }),
          stroke: new ol.style.Stroke({
            color: 'red',  // Red outline
            width: 3  // Thick outline
          })
        })
      })
    });
    map.addInteraction(select);

    const selectedFeatures = select.getFeatures();
    const popup = document.getElementById('popup');
    let overlay = new ol.Overlay({
      element: popup,
      positioning: 'bottom-center',
      stopEvent: false,
      offset: [0, -10]
    });
    map.addOverlay(overlay);

    selectedFeatures.on('add', function(event) {
      const feature = event.target.item(0);
      const properties = feature.getProperties();
      const coordinates = feature.getGeometry().getCoordinates();

      popup.innerHTML = `<span class="bold">Anzahl HÃ¼pferlinge:</span> ${properties.huepferlinge || '-'}<br>
      <span class="bold">Datum:</span> ${properties.datum || '-'}<br>
      <span class="bold">Bemerkung:</span> ${properties.bemerkung || '-'}<br>
      <span class="bold">Region:</span> ${properties.region || '-'}<br>`;
      overlay.setPosition(coordinates);
    });

    selectedFeatures.on('remove', function(event) {
      popup.innerHTML = '';
      overlay.setPosition(undefined);
    });
  </script>
</body>
</html>
